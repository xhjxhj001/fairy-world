# 精灵世界 - 用户指南

## 账号系统

### 首次使用

打开游戏时，您会看到登录注册界面，有三种选择：

1. **注册新账号**
   - 点击"注册"标签
   - 输入昵称（2-10个字符）
   - 输入账号（4-20个字符）
   - 输入密码（至少6个字符）
   - 确认密码
   - 点击"注册"按钮

2. **登录已有账号**
   - 输入账号和密码
   - 点击"登录"按钮

3. **访客模式**
   - 点击"访客模式"按钮
   - 系统自动分配访客账号
   - **注意**: 访客数据可能无法永久保存

### 退出登录

- 点击游戏顶部状态栏的昵称
- 在弹出的确认对话框中点击"确定"

## 多人社交功能

### 在线玩家

1. 点击底部的"社区"按钮
2. 选择"在线玩家"标签
3. 可以看到当前所有在线的玩家
4. 点击任意玩家卡片即可访问其小屋

### 访问其他玩家小屋

- 访问时，下方操作栏会变为特殊模式，只显示两个按钮：
  - **回到自己的小屋**: 返回自己的游戏界面
  - **添加为好友**: 向该玩家发送好友申请

### 好友系统

#### 发送好友申请
1. 访问其他玩家小屋
2. 点击"添加为好友"按钮
3. 对方会收到好友申请通知

#### 处理好友申请
1. 打开"社区"面板
2. 选择"好友"标签
3. 在"好友申请"区域可以看到所有申请
4. 点击"接受"或"拒绝"

#### 查看好友列表
- 在"好友"标签的"我的好友"区域可以看到所有好友

### 赠送礼物

1. 在好友列表中找到要赠送的好友
2. 点击"赠送"按钮
3. 在弹出的对话框中选择赠送类型：
   - **阳光露珠**: 输入数量（消耗自己的阳光）
   - **星光**: 输入数量（消耗自己的星光）
   - **照片**: 赠送最后一张照片
   - **纪念品**: 赠送最后一个纪念品
4. 确认后，礼物会立即发送给好友

### 地点分享

1. 让小狐狸旅行，收集照片
2. 打开"社区"面板，选择"共享地图"标签
3. 在"选择已发现的地点"中点击要分享的地点
4. 点击"分享选中的地点"按钮
5. 所有在线玩家都能看到你的分享

### 访客记录 ✨ 新功能

访客记录会自动记录三种类型的访客：

#### 1. 随机访客 🎁
- **触发条件**: 小狐狸外出旅行时，有30%概率触发
- **效果**: 神秘访客留下礼物（阳光或星光）
- **显示**: "神秘访客" + 礼物数量

#### 2. 玩家访问 👋
- **触发条件**: 其他玩家访问你的小屋
- **效果**: 记录访问者信息
- **显示**: 玩家昵称 + "来访问了你的小屋"
- **通知**: 你会收到实时通知

#### 3. 收到礼物 🎁
- **触发条件**: 好友赠送礼物给你
- **效果**: 详细记录礼物信息
- **显示**: 好友昵称 + 礼物详情（如"赠送了 50 阳光露珠"）
- **通知**: 你会收到实时通知

#### 查看访客记录
1. 点击底部"社区"按钮
2. 选择"访客"标签
3. 查看所有访客和礼物记录（最新的在上面）

#### 访客记录示例
```
👋 小明            ← 玩家访问
   2024/12/07
   来访问了你的小屋

🎁 好友A           ← 收到礼物
   2024/12/07
   赠送了 50 阳光露珠

🎁 神秘访客        ← 随机访客
   2024/12/07
   +15 ☀️ 阳光露珠
```

## 启动服务器

为了使用多人功能，需要启动 WebSocket 服务器：

```bash
node server.js
```

服务器将在 8080 端口运行。

## 注意事项

1. **密码安全**: 
   - ✅ 密码使用 bcrypt 加密存储在服务器端（已升级）
   - ✅ 账号数据完全由服务器管理
   - ✅ 建议使用6个字符以上的密码
   
2. **数据存储**:
   - ✅ 游戏数据保存在服务器端（已升级）
   - ✅ 自动保存，每30秒一次
   - ✅ 离线收益：最多累计24小时
   
3. **访客限制**: 
   - 访客数据不会持久化保存
   - 访客无法使用需要账号的高级功能
   
4. **网络连接**: 
   - 多人功能需要连接到 WebSocket 服务器
   - 会话有效期为24小时
   - 断线重连会自动使用已有会话
   
5. **好友赠送**: 赠送后物品会立即从你的收藏中移除

## 安全性说明

本游戏已实现以下安全措施：

- 🔒 服务器端账号管理系统
- 🔐 bcrypt密码加密（防止彩虹表攻击）
- 🔗 会话管理（24小时有效期）
- 📝 完整的输入验证
- 🔄 文件锁保护（防止并发冲突）
- ✅ 所有敏感操作需要身份认证

详见 `SECURITY.md` 和 `SECURITY_IMPROVEMENTS_SUMMARY.md`

## 游戏玩法

详见原有的 QUICKSTART.md 和 README.md 文档。

