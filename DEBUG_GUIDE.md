# è°ƒè¯•æŒ‡å—

## ğŸ› é—®é¢˜ï¼šç™»å½•åæ–­å¼€ï¼Œçœ‹ä¸åˆ°åœ¨çº¿ç©å®¶

### ğŸ“‹ æµ‹è¯•æ­¥éª¤

#### 1. é‡å¯æœåŠ¡å™¨ï¼ˆåº”ç”¨æ–°çš„è°ƒè¯•ä»£ç ï¼‰

```bash
# åœæ­¢æ—§æœåŠ¡å™¨
pkill -f "node server.js"

# å¯åŠ¨æ–°æœåŠ¡å™¨
cd /Users/xuhuanju/personal/Agent/fine-apps/idle-game-1
node server.js
```

#### 2. æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜å’ŒlocalStorage

åœ¨æµè§ˆå™¨ä¸­æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œç„¶åï¼š
- è¿›å…¥ `Application` æˆ– `å­˜å‚¨` æ ‡ç­¾
- ç‚¹å‡» `Local Storage` â†’ é€‰æ‹©ä½ çš„åŸŸå
- ç‚¹å‡» `Clear All` æˆ–åˆ é™¤æ‰€æœ‰é¡¹
- åˆ·æ–°é¡µé¢

#### 3. æµ‹è¯•å®Œæ•´ç™»å½•æµç¨‹

**æ­¥éª¤Aï¼šæ³¨å†Œç¬¬ä¸€ä¸ªè´¦å·**
1. è®¿é—® `http://172.26.27.91:5500/Agent/fine-apps/idle-game-1/auth.html`
2. æ³¨å†Œè´¦å·1ï¼ˆä¾‹å¦‚ï¼š`user1`ï¼‰
3. ç™»å½•ååº”è¯¥è‡ªåŠ¨è·³è½¬åˆ°æ¸¸æˆé¡µé¢

**æŸ¥çœ‹æµè§ˆå™¨Consoleï¼Œåº”è¯¥çœ‹åˆ°ï¼š**
```
ğŸ”— å·²è¿æ¥åˆ°æ¸¸æˆæœåŠ¡å™¨
ğŸ‘¤ å½“å‰ç”¨æˆ·: {username: "user1", ...}
ğŸ“¦ localStorage æ•°æ®: {sessionId: "...", ...}
ğŸ”‘ å‘é€ä¼šè¯è®¤è¯è¯·æ±‚, sessionId: ...
âœ… å·²ç™»å½•: xxx (user1)
```

**æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š**
```
ğŸ”Œ New client connected
ğŸ“¥ Received: register user1
ğŸ”Œ New client connected
ğŸ“¥ Received: login user1
User xxx logged in
User xxx disconnected          â† è¿™æ˜¯æ­£å¸¸çš„ï¼ˆauth.htmlå…³é—­ï¼‰
ğŸ”Œ New client connected
ğŸ“¥ Received: session_auth
User xxx reconnected with session  â† è¿™æ˜¯æ¸¸æˆé¡µé¢é‡è¿
ğŸ“¢ å¹¿æ’­åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå…± 1 äºº: xxx
```

**æ­¥éª¤Bï¼šæ‰“å¼€ç¬¬äºŒä¸ªæµè§ˆå™¨çª—å£/éšç§çª—å£**
1. æ‰“å¼€æ–°çª—å£è®¿é—® `auth.html`
2. æ³¨å†Œå¹¶ç™»å½•è´¦å·2ï¼ˆä¾‹å¦‚ï¼š`user2`ï¼‰

**æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š**
```
ğŸ“¢ å¹¿æ’­åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå…± 2 äºº: xxx, yyy
```

**æ­¥éª¤Cï¼šæŸ¥çœ‹åœ¨çº¿ç©å®¶åˆ—è¡¨**
1. åœ¨ä»»ä¸€çª—å£ç‚¹å‡»åº•éƒ¨"ç¤¾åŒº"æŒ‰é’®
2. é€‰æ‹©"åœ¨çº¿ç©å®¶"æ ‡ç­¾

**æŸ¥çœ‹æµè§ˆå™¨Consoleï¼Œåº”è¯¥çœ‹åˆ°ï¼š**
```
ğŸ‘¥ æ”¶åˆ°åœ¨çº¿ç”¨æˆ·åˆ—è¡¨: [{username: "user1", ...}, {username: "user2", ...}]
ğŸ¨ æ¸²æŸ“åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå…± 2 äºº
ğŸ‘¤ å½“å‰ç”¨æˆ·: user1
ğŸ‘¥ å…¶ä»–ç”¨æˆ·: [{username: "user2", ...}]
```

---

## ğŸ” è¯Šæ–­æ¸…å•

### âŒ å¦‚æœçœ‹åˆ° "âŒ æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"
**åŸå› **ï¼šç›´æ¥è®¿é—®äº† index.htmlï¼Œè€Œæ²¡æœ‰é€šè¿‡ auth.html ç™»å½•  
**è§£å†³**ï¼šå¿…é¡»å…ˆè®¿é—® auth.html è¿›è¡Œç™»å½•

### âŒ å¦‚æœçœ‹åˆ° "âŒ æ— ä¼šè¯IDï¼Œè¯·é‡æ–°ç™»å½•"
**åŸå› **ï¼šlocalStorage ä¸­æ²¡æœ‰ä¿å­˜ sessionId  
**è§£å†³**ï¼š
1. æ¸…ç©º localStorage
2. é‡æ–°ä» auth.html ç™»å½•
3. ç¡®ä¿ç™»å½•æˆåŠŸåçœ‹åˆ° `login_result` æ¶ˆæ¯

### âŒ å¦‚æœæœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ° session_auth
**åŸå› **ï¼šWebSocket è¿æ¥å¤±è´¥æˆ–ä»£ç é”™è¯¯  
**æ£€æŸ¥**ï¼š
1. æœåŠ¡å™¨æ˜¯å¦åœ¨è¿è¡Œï¼Ÿ
2. ç«¯å£8080æ˜¯å¦è¢«å ç”¨ï¼Ÿ
3. æµè§ˆå™¨Consoleæ˜¯å¦æœ‰é”™è¯¯ï¼Ÿ

### âŒ å¦‚æœåœ¨çº¿ç”¨æˆ·åˆ—è¡¨ä¸ºç©º
**åŸå› 1**ï¼šæœåŠ¡å™¨æ²¡æœ‰å¹¿æ’­åœ¨çº¿ç”¨æˆ·åˆ—è¡¨  
**æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—**ï¼šæ˜¯å¦çœ‹åˆ° `ğŸ“¢ å¹¿æ’­åœ¨çº¿ç”¨æˆ·åˆ—è¡¨`

**åŸå› 2**ï¼šè®¤è¯å¤±è´¥ï¼Œæ²¡æœ‰è¢«åŠ å…¥åœ¨çº¿ç”¨æˆ·åˆ—è¡¨  
**æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—**ï¼šæ˜¯å¦çœ‹åˆ° `User xxx reconnected with session`

**åŸå› 3**ï¼šåªæœ‰è‡ªå·±åœ¨çº¿  
**è§£å†³**ï¼šæ‰“å¼€å¤šä¸ªæµè§ˆå™¨çª—å£/éšç§çª—å£ç™»å½•ä¸åŒè´¦å·

---

## ğŸ“Š æ­£ç¡®çš„æ—¥å¿—æµç¨‹ç¤ºä¾‹

### æœåŠ¡å™¨æ—¥å¿—ï¼ˆå®Œæ•´æµç¨‹ï¼‰
```
WebSocket server started on port 8080
User data directory: ...
Accounts file: ...

# ç”¨æˆ·1æ³¨å†Œ
ğŸ”Œ New client connected
ğŸ“¥ Received: register user1

# ç”¨æˆ·1åœ¨auth.htmlç™»å½•
ğŸ”Œ New client connected
ğŸ“¥ Received: login user1
User ç”¨æˆ·1 logged in
ğŸ“¢ å¹¿æ’­åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå…± 1 äºº: ç”¨æˆ·1
User ç”¨æˆ·1 disconnected    â† auth.html å…³é—­

# ç”¨æˆ·1åœ¨index.htmlé‡è¿
ğŸ”Œ New client connected
ğŸ“¥ Received: session_auth
User ç”¨æˆ·1 reconnected with session
ğŸ“¢ å¹¿æ’­åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå…± 1 äºº: ç”¨æˆ·1

# ç”¨æˆ·2ç™»å½•ï¼ˆå¦ä¸€ä¸ªçª—å£ï¼‰
ğŸ”Œ New client connected
ğŸ“¥ Received: register user2
ğŸ”Œ New client connected
ğŸ“¥ Received: login user2
User ç”¨æˆ·2 logged in
ğŸ“¢ å¹¿æ’­åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå…± 2 äºº: ç”¨æˆ·1, ç”¨æˆ·2
User ç”¨æˆ·2 disconnected    â† auth.html å…³é—­

# ç”¨æˆ·2åœ¨index.htmlé‡è¿
ğŸ”Œ New client connected
ğŸ“¥ Received: session_auth
User ç”¨æˆ·2 reconnected with session
ğŸ“¢ å¹¿æ’­åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå…± 2 äºº: ç”¨æˆ·1, ç”¨æˆ·2
```

### æµè§ˆå™¨Consoleï¼ˆç”¨æˆ·1ï¼‰
```
ğŸ” æ£€æŸ¥ç™»å½•çŠ¶æ€: {username: "user1", nickname: "ç”¨æˆ·1", sessionId: "..."}
âœ… å·²ç™»å½•: ç”¨æˆ·1 ( user1 )
ğŸ”— å·²è¿æ¥åˆ°æ¸¸æˆæœåŠ¡å™¨
ğŸ‘¤ å½“å‰ç”¨æˆ·: {username: "user1", ...}
ğŸ“¦ localStorage æ•°æ®: {username: "user1", sessionId: "..."}
ğŸ”‘ å‘é€ä¼šè¯è®¤è¯è¯·æ±‚, sessionId: 1234567890-xxx
å·²è¿æ¥åˆ°å¤šäººç¤¾åŒº

# å½“ç”¨æˆ·2ä¸Šçº¿æ—¶
ğŸ‘¥ æ”¶åˆ°åœ¨çº¿ç”¨æˆ·åˆ—è¡¨: [{username: "user1", ...}, {username: "user2", ...}]

# æ‰“å¼€ç¤¾åŒºé¢æ¿æŸ¥çœ‹åœ¨çº¿ç©å®¶
ğŸ¨ æ¸²æŸ“åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå…± 2 äºº
ğŸ‘¤ å½“å‰ç”¨æˆ·: user1
ğŸ‘¥ å…¶ä»–ç”¨æˆ·: [{username: "user2", nickname: "ç”¨æˆ·2"}]
```

---

## ğŸ¯ å…³é”®æ£€æŸ¥ç‚¹

### âœ… ç™»å½•é¡µé¢ (auth.html)
1. è¿æ¥WebSocket
2. å‘é€ç™»å½•è¯·æ±‚
3. æ”¶åˆ° `login_result` åŒ…å« sessionId
4. ä¿å­˜åˆ° localStorage
5. è·³è½¬åˆ° index.html
6. è¿æ¥æ–­å¼€ï¼ˆæ­£å¸¸ï¼ï¼‰

### âœ… æ¸¸æˆé¡µé¢ (index.html)
1. æ£€æŸ¥ localStorage æœ‰ sessionId
2. è¿æ¥WebSocket
3. å‘é€ `session_auth` è¯·æ±‚
4. æ”¶åˆ° `session_auth_result` æˆåŠŸ
5. è¢«åŠ å…¥åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
6. æ”¶åˆ° `online_users` å¹¿æ’­

### âœ… å¤šäººæµ‹è¯•
1. ä½¿ç”¨ä¸åŒæµè§ˆå™¨/éšç§çª—å£
2. æ³¨å†Œä¸åŒè´¦å·
3. éƒ½å®Œæˆä¸Šè¿°æµç¨‹
4. åŒæ–¹éƒ½åº”è¯¥çœ‹åˆ°å¯¹æ–¹åœ¨çº¿

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•è„šæœ¬

### æµ‹è¯•1ï¼šå•ç”¨æˆ·ç™»å½•
```bash
# è®¿é—®
open http://172.26.27.91:5500/Agent/fine-apps/idle-game-1/auth.html

# æŸ¥çœ‹æ—¥å¿—
tail -f æœåŠ¡å™¨ç»ˆç«¯è¾“å‡º
```

### æµ‹è¯•2ï¼šå¤šç”¨æˆ·åœ¨çº¿
```bash
# çª—å£1ï¼šæ­£å¸¸æµè§ˆå™¨
open http://172.26.27.91:5500/Agent/fine-apps/idle-game-1/auth.html

# çª—å£2ï¼šéšç§æ¨¡å¼
open -na "Google Chrome" --args --incognito http://172.26.27.91:5500/Agent/fine-apps/idle-game-1/auth.html
```

---

## ğŸ“ æŠ¥å‘Šé—®é¢˜æ—¶è¯·æä¾›

1. **æœåŠ¡å™¨å®Œæ•´æ—¥å¿—**ï¼ˆä»å¯åŠ¨åˆ°å‡ºç°é—®é¢˜ï¼‰
2. **æµè§ˆå™¨Consoleå®Œæ•´è¾“å‡º**
3. **localStorageå†…å®¹**ï¼ˆApplication â†’ Local Storageï¼‰
4. **è®¿é—®çš„å®Œæ•´URL**
5. **æ“ä½œæ­¥éª¤**ï¼ˆä»å“ªä¸ªé¡µé¢å¼€å§‹ï¼Œåšäº†ä»€ä¹ˆï¼‰

è¿™æ ·æˆ‘å°±èƒ½å¿«é€Ÿå®šä½é—®é¢˜ï¼ğŸ’ª

