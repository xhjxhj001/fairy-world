<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²¾çµä¸–ç•Œ - æ²»æ„ˆæ”¾ç½®æ¸¸æˆ</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        console.log('ğŸ® index.html æ­£åœ¨åŠ è½½...');
        const currentUser = localStorage.getItem('currentUser');
        console.log('ğŸ“¦ localStorage currentUser:', currentUser);

        if (!currentUser) {
            console.log('âŒ æœªæ‰¾åˆ°ç™»å½•ä¿¡æ¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ');
            window.location.href = 'auth.html';
        } else {
            console.log('âœ… æ‰¾åˆ°ç™»å½•ä¿¡æ¯ï¼Œç»§ç»­åŠ è½½æ¸¸æˆ');
            try {
                const userData = JSON.parse(currentUser);
                console.log('ğŸ‘¤ ç”¨æˆ·æ•°æ®:', userData);
            } catch (e) {
                console.error('âŒ è§£æç”¨æˆ·æ•°æ®å¤±è´¥:', e);
            }
        }
    </script>
</head>

<body>
    <div id="game-container" class="game-container">
        <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="user-info" id="user-info">
                <span id="user-nickname"></span>
            </div>
            <div class="resource-group">
                <div class="resource-item">
                    <span class="resource-icon">â˜€ï¸</span>
                    <span id="sunlight-count">0</span>
                </div>
                <div class="resource-item">
                    <span class="resource-icon">âœ¨</span>
                    <span id="starlight-count">0</span>
                </div>
            </div>
            <div class="time-indicator" id="time-indicator">
                <span id="time-text">ç™½å¤©</span>
            </div>
            <button class="music-toggle-btn" id="music-toggle-btn" title="éŸ³ä¹æ§åˆ¶">
                ğŸµ
            </button>
        </div>

        <!-- ä¸»åœºæ™¯ -->
        <div class="main-scene" id="main-scene">
            <!-- èƒŒæ™¯å±‚ -->
            <div class="background-layer" id="background-layer">
                <div class="house-container" id="house">
                    <!-- House will be rendered via CSS background -->
                </div>
                <div class="garden" id="garden">
                    <div class="resource-field sunlight-field" id="sunlight-field"></div>
                    <div class="resource-field starlight-field" id="starlight-field"></div>
                </div>
                <div class="sky" id="sky">
                    <div class="cloud" style="left: 10%; animation-delay: 0s;"></div>
                    <div class="cloud" style="left: 50%; animation-delay: 2s;"></div>
                    <div class="cloud" style="left: 80%; animation-delay: 4s;"></div>
                </div>
            </div>

            <!-- ä¸»è§’ -->
            <div class="character" id="character">
                <div class="character-sprite" id="character-sprite"></div>
                <div class="character-status" id="character-status">åœ¨å®¶</div>
            </div>

            <!-- è®¿å®¢æç¤º -->
            <div class="visitor-notice" id="visitor-notice" style="display: none;">
                <div class="notice-content">
                    <span class="notice-icon">ğŸ</span>
                    <span class="notice-text">æœ‰è®¿å®¢ç•™ä¸‹äº†ç¤¼ç‰©ï¼</span>
                </div>
            </div>
        </div>

        <!-- é¢æ¿é®ç½© -->
        <div class="panel-overlay" id="panel-overlay"></div>

        <!-- åº•éƒ¨æ“ä½œæ  -->
        <div class="action-bar" id="action-bar">
            <button class="action-btn" id="backpack-btn">
                <span class="btn-icon">ğŸ’</span>
                <span class="btn-text">è¡Œå›Š</span>
            </button>
            <button class="action-btn" id="collection-btn">
                <span class="btn-icon">ğŸ“·</span>
                <span class="btn-text">æ”¶è—</span>
            </button>
            <button class="action-btn" id="social-btn">
                <span class="btn-icon">ğŸŒ</span>
                <span class="btn-text">ç¤¾åŒº</span>
            </button>
            <button class="action-btn" id="sleep-btn">
                <span class="btn-icon">ğŸŒ™</span>
                <span class="btn-text">åŠ©çœ </span>
            </button>
        </div>

        <!-- è®¿é—®æ¨¡å¼ä¸‹çš„ç‰¹æ®Šæ“ä½œæ  -->
        <div class="visitor-action-bar" id="visitor-action-bar" style="display: none;">
            <button class="visitor-btn" id="back-home-btn">
                <span class="btn-icon">ğŸ </span>
                <span class="btn-text">å›åˆ°è‡ªå·±çš„å°å±‹</span>
            </button>
            <button class="visitor-btn" id="add-friend-btn">
                <span class="btn-icon">â•</span>
                <span class="btn-text">æ·»åŠ ä¸ºå¥½å‹</span>
            </button>
        </div>

        <!-- è¡Œå›Šé¢æ¿ -->
        <div class="panel" id="backpack-panel">
            <div class="panel-header">
                <h2>å‡†å¤‡è¡Œå›Š</h2>
                <button class="close-btn" id="close-backpack">âœ•</button>
            </div>
            <div class="panel-content">
                <div class="selected-items">
                    <div class="selected-header">
                        <h3>å·²é€‰æ‹©</h3>
                        <span class="selected-hint">ç‚¹å‡» Ã— å–æ¶ˆé€‰æ‹©</span>
                    </div>
                    <div class="selected-list" id="selected-items"></div>
                    <button class="confirm-btn" id="confirm-backpack">ç¡®è®¤å‡ºå‘</button>
                </div>
                <div class="item-category">
                    <h3>é£Ÿç‰©</h3>
                    <div class="item-list-wrapper">
                        <div class="item-list horizontal-scroll" id="food-list"></div>
                    </div>
                </div>
                <div class="item-category">
                    <h3>ç©å…·</h3>
                    <div class="item-list-wrapper">
                        <div class="item-list horizontal-scroll" id="toy-list"></div>
                    </div>
                </div>
                <div class="item-category">
                    <h3>æŠ¤èº«ç¬¦</h3>
                    <div class="item-list-wrapper">
                        <div class="item-list horizontal-scroll" id="charm-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ”¶è—é¢æ¿ -->
        <div class="panel" id="collection-panel">
            <div class="panel-header">
                <h2>æˆ‘çš„æ”¶è—</h2>
                <button class="close-btn" id="close-collection">âœ•</button>
            </div>
            <div class="panel-content">
                <div class="collection-tabs">
                    <button class="tab-btn active" data-tab="photos">ç…§ç‰‡</button>
                    <button class="tab-btn" data-tab="souvenirs">çºªå¿µå“</button>
                    <button class="tab-btn" data-tab="dreams">æ¢¦å¢ƒ</button>
                </div>
                <div class="collection-content" id="collection-content"></div>
            </div>
        </div>

        <!-- ç¤¾åŒºé¢æ¿ -->
        <div class="panel" id="social-panel">
            <div class="panel-header">
                <h2>å…±äº«ç¤¾åŒº</h2>
                <button class="close-btn" id="close-social">âœ•</button>
            </div>
            <div class="panel-content">
                <div class="social-tabs">
                    <button class="tab-btn active" data-tab="map">å…±äº«åœ°å›¾</button>
                    <button class="tab-btn" data-tab="online">åœ¨çº¿ç©å®¶</button>
                    <button class="tab-btn" data-tab="visitors">è®¿å®¢è®°å½•</button>
                    <button class="tab-btn" data-tab="friends">å¥½å‹</button>
                </div>
                <div class="social-content" id="social-content"></div>
            </div>
        </div>

        <!-- åŠ©çœ é¢æ¿ -->
        <div class="panel" id="sleep-panel">
            <div class="panel-header">
                <h2>æ™šå®‰æ—¶å…‰</h2>
                <button class="close-btn" id="close-sleep">âœ•</button>
            </div>
            <div class="panel-content">
                <div class="sleep-options">
                    <button class="sleep-option-btn" id="story-btn">
                        <span class="option-icon">ğŸ“–</span>
                        <span class="option-text">æ™šå®‰æ•…äº‹</span>
                    </button>
                    <button class="sleep-option-btn" id="sleep-mode-btn">
                        <span class="option-icon">ğŸŒ™</span>
                        <span class="option-text">ç¡çœ æ¨¡å¼</span>
                    </button>
                    <div class="dream-preview" id="dream-preview" style="display: none;">
                        <h3>æ˜¨æ™šçš„æ¢¦å¢ƒ</h3>
                        <div class="dream-image" id="dream-image"></div>
                        <p class="dream-text" id="dream-text"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¡çœ æ¨¡å¼å…¨å± -->
        <div class="sleep-mode" id="sleep-mode" style="display: none;">
            <div class="sleep-character" id="sleep-character"></div>
            <div class="sleep-controls">
                <button class="wake-btn" id="wake-btn">å”¤é†’</button>
            </div>
        </div>

        <!-- é€šçŸ¥æç¤º -->
        <div class="notification" id="notification" style="display: none;">
            <span id="notification-text"></span>
        </div>
    </div>

    <script src="game.js"></script>
</body>

</html>